// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

// Looking for ways to speed up your queries, or scale easily with your serverless or edge functions?
// Try Prisma Accelerate: https://pris.ly/cli/accelerate-init

generator client {
  provider = "prisma-client-js"
  // output   = "../generated/prisma"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

enum Role {
  ADMIN
  OPERATOR
}

enum StatusUser {
  ACTIVE
  INACTIVE
}

enum NoType {
  NUMERIC
  ALPHANUMERIC
  CUSTOM
}

enum UniqueConstraintType {
  NONE
  NO
  NO_TANGGAL
  NO_NOFISIK
}

model User {
  id           Int          @id @default(autoincrement())
  name         String
  email        String       @unique
  username     String       @unique
  password     String
  role         Role         @default(OPERATOR)
  statusUser   StatusUser   @default(ACTIVE)
  refreshToken String?
  createdAt    DateTime     @default(now())
  updatedAt    DateTime     @updatedAt
  arsipFiles   ArsipFile[]
  arsipSemua   ArsipSemua[]
}

model Kategori {
  id          Int     @id @default(autoincrement())
  name        String  @unique
  slug        String  @unique
  description String?

  formNo           String
  rulesFormNo      Boolean
  rulesFormNama    Boolean
  rulesFormTanggal Boolean
  maxFile          Int

  // Dynamic Validation Rules
  noType      NoType  @default(ALPHANUMERIC)
  noMinLength Int?
  noMaxLength Int?
  noRegex     String?
  noPrefix    String?
  noFormat    String?
  noMask      String?

  uniqueConstraint UniqueConstraintType @default(NONE)
  isEncrypt        Boolean              @default(false)

  createdAt   DateTime     @default(now())
  updatedAt   DateTime     @updatedAt
  arsipSemuas ArsipSemua[]
  arsipFiles  ArsipFile[]
}

model ArsipSemua {
  id          Int         @default(autoincrement())
  idKategori  Int
  kategori    Kategori    @relation(fields: [idKategori], references: [id], onDelete: Cascade)
  no          String
  noEnc       String?
  noHash      String?
  nama        String?
  tanggal     DateTime?
  noFisik     String
  createdById Int?
  createdBy   User?       @relation(fields: [createdById], references: [id], onDelete: SetNull)
  arsipFiles  ArsipFile[]
  isSync      Boolean     @default(false)
  syncAt      DateTime?

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@id([id, idKategori])
  @@index([idKategori])
  @@index([idKategori, no])
  @@index([idKategori, no, tanggal])
  @@index([idKategori, no, noFisik])
}

model ArsipFile {
  id         Int      @default(autoincrement())
  path       String
  uploadById Int?
  uploadBy   User?    @relation(fields: [uploadById], references: [id], onDelete: SetNull)
  createdAt  DateTime @default(now())
  updatedAt  DateTime @updatedAt

  arsipSemua   ArsipSemua? @relation(fields: [arsipSemuaId, idKategori], references: [id, idKategori], onDelete: Cascade)
  arsipSemuaId Int?

  idKategori Int
  kategori   Kategori @relation(fields: [idKategori], references: [id], onDelete: Cascade)

  @@id([id, idKategori])
}
