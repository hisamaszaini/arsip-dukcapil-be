// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

// Looking for ways to speed up your queries, or scale easily with your serverless or edge functions?
// Try Prisma Accelerate: https://pris.ly/cli/accelerate-init

generator client {
  provider = "prisma-client-js"
  // output   = "../generated/prisma"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

enum Role {
  ADMIN
  OPERATOR
}

enum StatusUser {
  ACTIVE
  INACTIVE
}

model User {
  id                         Int                          @id @default(autoincrement())
  name                       String
  email                      String                       @unique
  username                   String                       @unique
  password                   String
  role                       Role                         @default(OPERATOR)
  statusUser                 StatusUser                   @default(ACTIVE)
  refreshToken               String?
  createdAt                  DateTime                     @default(now())
  updatedAt                  DateTime                     @updatedAt
  AktaKematian               AktaKematian[]
  AktaKelahiran              AktaKelahiran[]
  SuratKehilangan            SuratKehilangan[]
  SuratPermohonanPindah      SuratPermohonanPindah[]
  SuratPerubahanKependudukan SuratPerubahanKependudukan[]
  arsipFiles                 ArsipFile[]
}

model ArsipFile {
  id              Int                         @id @default(autoincrement())
  originalName    String
  path            String
  aktaKematianId  Int?
  aktaKematian    AktaKematian?               @relation(fields: [aktaKematianId], references: [id], onDelete: Cascade)
  aktaKelahiranId Int?
  aktaKelahiran   AktaKelahiran?              @relation(fields: [aktaKelahiranId], references: [id], onDelete: Cascade)
  suratPerPinId   Int?
  suratPerPin     SuratPermohonanPindah?      @relation(fields: [suratPerPinId], references: [id], onDelete: Cascade)
  suratPerKpnId   Int?
  suratPerKpn     SuratPerubahanKependudukan? @relation(fields: [suratPerKpnId], references: [id], onDelete: Cascade)
  uploadById      Int?
  uploadBy        User?                       @relation(fields: [uploadById], references: [id], onDelete: SetNull)
  createdAt       DateTime                    @default(now())
  updatedAt       DateTime                    @updatedAt
}

model AktaKematian {
  id          Int         @id @default(autoincrement())
  noAkta      String      @unique
  noAktaEnc   String?
  noAktaHash  String?     @unique
  noFisik     String
  createdById Int?
  createdBy   User?       @relation(fields: [createdById], references: [id], onDelete: SetNull)
  createdAt   DateTime    @default(now())
  updatedAt   DateTime    @updatedAt
  arsipFiles  ArsipFile[]

  @@index([createdAt])
  @@index([createdById])
}

model AktaKelahiran {
  id          Int         @id @default(autoincrement())
  noAkta      String      @unique
  noAktaEnc   String?
  noAktaHash  String?     @unique
  noFisik     String
  createdById Int?
  createdBy   User?       @relation(fields: [createdById], references: [id], onDelete: SetNull)
  createdAt   DateTime    @default(now())
  updatedAt   DateTime    @updatedAt
  arsipFiles  ArsipFile[]

  @@index([createdAt])
  @@index([createdById])
}

model SuratKehilangan {
  id          Int      @id @default(autoincrement())
  nik         String
  nikEnc      String?
  nikHash     String?  @unique
  tanggal     DateTime @db.Date
  noFisik     String
  file        String
  createdById Int?
  createdBy   User?    @relation(fields: [createdById], references: [id], onDelete: SetNull)
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  @@index([createdAt])
  @@index([createdById])
}

model SuratPermohonanPindah {
  id          Int         @id @default(autoincrement())
  nik         String
  nikEnc      String?
  nikHash     String?     @unique
  noFisik     String
  createdById Int?
  createdBy   User?       @relation(fields: [createdById], references: [id], onDelete: SetNull)
  createdAt   DateTime    @default(now())
  updatedAt   DateTime    @updatedAt
  arsipFiles  ArsipFile[]

  @@index([createdAt])
  @@index([createdById])
}

model SuratPerubahanKependudukan {
  id          Int         @id @default(autoincrement())
  nik         String
  nikEnc      String?
  nikHash     String?     @unique
  noFisik     String
  createdById Int?
  createdBy   User?       @relation(fields: [createdById], references: [id], onDelete: SetNull)
  createdAt   DateTime    @default(now())
  updatedAt   DateTime    @updatedAt
  arsipFiles  ArsipFile[]

  @@index([createdAt])
  @@index([createdById])
}
